{"version":3,"sources":["../../../widgets/Distribucion_Clientes/Widget.js"],"names":["define","declare","BaseWidget","HeatmapRenderer","FeatureLayer","Extent","SpatialReference","HeatmapSlider","lang","DynamicLayer","capa_clientes","capa_clientes_options","capa_clientes_calor","deslizadorColor","myStops","baseClass","postCreate","inherited","arguments","console","log","startup","mimapa","map","graphicsLayerIds","onOpen","mode","MODE_SNAPSHOT","addLayer","extension","wkid","setExtent","mangos","deslizador","MapaCalor","calorRender","blurRadius","radioSelect","value","maxPixelIntensity","maxpx","minPixelIntensity","minpx","colorStops","setColorStops","setRenderer","alert","actualizar","redraw","onClose","removeLayer"],"mappings":"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","file":"Widget.js","sourcesContent":["define(['dojo/_base/declare', 'jimu/BaseWidget',\r\n\"esri/renderers/HeatmapRenderer\",\r\n\"esri/layers/FeatureLayer\",\r\n\"esri/geometry/Extent\",\r\n\"esri/SpatialReference\",\r\n\"esri/dijit/HeatmapSlider\",\r\n\"dojo/_base/lang\",\r\n\"esri/layers/ArcGISDynamicMapServiceLayer\",\r\n],\r\nfunction(declare, BaseWidget, HeatmapRenderer, FeatureLayer, Extent, SpatialReference, HeatmapSlider, lang, DynamicLayer) {\r\n\r\n  let capa_clientes;\r\n  var capa_clientes_options;\r\n  let capa_clientes_calor;\r\n  var deslizadorColor;\r\n  var myStops;\r\n\r\n \r\n\r\n  //To create a widget, you need to derive from BaseWidget.\r\n  return declare([BaseWidget], {\r\n\r\n    // Custom widget code goes here\r\n\r\n    baseClass: 'distribucion-clientes',\r\n    // this property is set by the framework when widget is loaded.\r\n    // name: 'Distribucion_Clientes',\r\n    // add additional properties here\r\n\r\n    //methods to communication with app container:\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      console.log('Distribucion_Clientes::postCreate');\r\n\r\n      /*var capa_dinamica_renta_map_server = new DynamicLayer(\"https://localhost:6443/arcgis/rest/services/Proyecto/Servicio_Densidad_Renta_Com_Madrid/MapServer\")\r\n\r\n      this.map.addLayer(capa_dinamica_renta_map_server)*/\r\n    },\r\n\r\n    startup: function() {\r\n      this.inherited(arguments);\r\n      console.log('Distribucion_Clientes::startup');\r\n      mimapa = this.map\r\n      console.log(mimapa)\r\n      console.log(this.map.graphicsLayerIds)\r\n    },\r\n\r\n    onOpen: function(){\r\n\r\n\r\n      console.log('Distribucion_Clientes::onOpen');\r\n\r\n      /*if(this.map.graphicsLayerIds.length < 4){}*/     \r\n\r\n      capa_clientes_options = {\r\n        mode: FeatureLayer.MODE_SNAPSHOT,\r\n\r\n      }\r\n      \r\n      capa_clientes = new FeatureLayer (\"https://localhost:6443/arcgis/rest/services/Proyecto/Servicio_Clientes/FeatureServer/0\", capa_clientes_options)\r\n\r\n        this.map.addLayer(capa_clientes)\r\n\r\n        var extension = new Extent (-469129.1882000007, 4868948.761299998, -345686.1994000003, 5001644.391199999,  new SpatialReference({ wkid:102100}) )\r\n\r\n      this.map.setExtent(extension)\r\n\r\n      myStops = [\r\n        {\"ratio\":0,\"color\":{\r\n          \"r\":133,\"g\":193,\"b\":200,\"a\":0}\r\n        },\r\n        {\"ratio\":0.01,\"color\":{\r\n          \"r\":133,\"g\":193,\"b\":200,\"a\":0}\r\n        },\r\n        {\"ratio\":0.01,\"color\":{\r\n          \"r\":133,\"g\":193,\"b\":200,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.01,\"color\":{\r\n          \"r\":133,\"g\":193,\"b\":200,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.0925,\"color\":{\r\n          \"r\":144,\"g\":161,\"b\":190,\"a\":0.7}\r\n        }, \r\n        {\"ratio\":0.17500000000000002,\"color\":{\r\n          \"r\":156,\"g\":129,\"b\":132,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.2575,\"color\":{\r\n          \"r\":167,\"g\":97,\"b\":170,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.34,\"color\":{\r\n          \"r\":175,\"g\":73,\"b\":128,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.42250000000000004,\"color\":{\r\n          \"r\":184,\"g\":48,\"b\":85,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.505,\"color\":{\r\n          \"r\":192,\"g\":24,\"b\":42,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.5875,\"color\":{\r\n          \"r\":200,\"g\":0,\"b\":0,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.67,\"color\":{\r\n          \"r\":211,\"g\":51,\"b\":0,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.7525000000000001,\"color\":{\r\n          \"r\":222,\"g\":102,\"b\":0,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.8350000000000001,\"color\":{\r\n          \"r\":233,\"g\":153,\"b\":0,\"a\":0.7}\r\n        },\r\n        {\"ratio\":0.9175000000000001,\"color\":{\r\n          \"r\":244,\"g\":204,\"b\":0,\"a\":0.7}\r\n        },\r\n        {\"ratio\":1,\"color\":{\r\n          \"r\":255,\"g\":255,\"b\":0,\"a\":0.7}\r\n        }\r\n      ];\r\n\r\n      var mangos = [3,15]\r\n\r\n     deslizadorColor = new HeatmapSlider({        \r\n        \"colorStops\": myStops,\r\n        \"hansles\": mangos,\r\n        \"showLabels\" : true,\r\n      }, this.deslizador);\r\n\r\n      deslizadorColor.startup();     \r\n\r\n      \r\n    },\r\n\r\n    MapaCalor(){\r\n      \r\n\r\n      /*capa_clientes_calor = new FeatureLayer (\"https://localhost:6443/arcgis/rest/services/Proyecto/Servicio_Clientes/FeatureServer/0\")*/         \r\n           \r\n      \r\n\r\n      var calorRender = new HeatmapRenderer({        \r\n        // colors: [\"rgba(0, 0, 255, 0)\",\"rgb(0, 0, 255)\",\"rgb(255, 0, 255)\", \"rgb(255, 0, 0)\"],\r\n        blurRadius: this.radioSelect.value,\r\n        maxPixelIntensity: this.maxpx.value,\r\n        minPixelIntensity: this.minpx.value,\r\n        colorStops: myStops})\r\n\r\n      \r\n\r\n      calorRender.setColorStops(myStops);       \r\n\r\n\r\n    if (this.maxpx.value != 0 & this.minpx.value != 0 & this.radioSelect.value !=0){\r\n\r\n      capa_clientes_calor = capa_clientes.setRenderer(calorRender);\r\n\r\n\r\n      /*capa_clientes.setRenderer(calorRender);*/\r\n\r\n      this.map.addLayer(capa_clientes_calor); \r\n           \r\n           \r\n  \r\n    }else{\r\n    \r\n  \r\n        alert(\"Introduce el radio del círculo, los valores máximos y mínimos de los píxeles\")      \r\n\r\n     };\r\n\r\n     console.log(\"MImAPA:\", mimapa)\r\n     console.log(this.map.graphicsLayerIds)      \r\n      \r\n\r\n      // var id = this.map.graphicsLayerIds\r\n\r\n      // console.log(\"Lista capas:\" + id)\r\n\r\n      // for(i = 0; i > 2; i++){\r\n\r\n      //   var layer = this.map.graphicsLayerIds([i])       \r\n\r\n\r\n      // }\r\n\r\n      // deslizadorColor.on([\"thumb-change\", \"thumb-drag\"], function() {\r\n      //   const renderer = capa_clientes_calor.renderer.clone();\r\n      //   renderer.myStops = deslizadorColor.stops;\r\n      //   capa_clientes_calor.renderer = renderer;\r\n      // })\r\n\r\n\r\n      // var renderizador = this.deslizador\r\n\r\n      // renderizador.addEventListener(\"handle-value-change\", function (evt){\r\n      //   var c = +evt.target.value;\r\n      //   if (c !== calorRender.colorStops) {\r\n      //     calorRender.colorStops = c;\r\n      //     capa_clientes_calor.redraw();\r\n      //   }\r\n      // });\r\n    \r\n      \r\n      \r\n              \r\n      \r\n    },\r\n\r\n    actualizar(){\r\n      \r\n\r\n      calorRender.setColorStops(myStops)\r\n      capa_clientes.setRenderer(calorRender)\r\n      capa_clientes.redraw();\r\n\r\n\r\n\r\n    },      \r\n      \r\n      \r\n    /*Cada vez que se realiza el cálculo, los valores de desenfoque se suman a los píxeles subyacentes. Los resultados son acumulativos, por lo que un píxel que tenga varios puntos cerca tendrá un valor más alto que un píxel con un solo punto. Este valor acumulado se denomina intensidad del píxel.\"*/   \r\n    \r\n\r\n    onClose: function(){\r\n      \r\n      console.log(\"Mi mapa cerrado:\" , mimapa)\r\n\r\n      this.map.removeLayer(capa_clientes)\r\n\r\n      /*var intro = document.getElementById(\"Introduccion\")\r\n      var info = document.getElementById(\"Informacion\")*/\r\n\r\n      /*intro.remove()\r\n      info.remove()*/\r\n\r\n      \r\n    },\r\n\r\n    // onMinimize: function(){\r\n    //   console.log('Distribucion_Clientes::onMinimize');\r\n    // },\r\n\r\n    // onMaximize: function(){\r\n    //   console.log('Distribucion_Clientes::onMaximize');\r\n    // },\r\n\r\n    // onSignIn: function(credential){\r\n    //   console.log('Distribucion_Clientes::onSignIn', credential);\r\n    // },\r\n\r\n    // onSignOut: function(){\r\n    //   console.log('Distribucion_Clientes::onSignOut');\r\n    // }\r\n\r\n    // onPositionChange: function(){\r\n    //   console.log('Distribucion_Clientes::onPositionChange');\r\n    // },\r\n\r\n    // resize: function(){\r\n    //   console.log('Distribucion_Clientes::resize');\r\n    // }\r\n\r\n    //methods to communication between widgets:\r\n\r\n  });\r\n\r\n});\r\n"]}